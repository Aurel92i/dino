<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Mini Gazier Runner</title>
  <style>
    :root {
      color-scheme: light;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: clamp(16px, 6vw, 40px);
      background: linear-gradient(180deg, #78c3ff 0%, #a0ddff 60%, #fdf4d6 100%);
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100dvh;
    }
    #gazier-runner {
      position: relative;
      width: min(460px, 96vw);
      height: clamp(220px, 54vh, 340px);
      background: linear-gradient(#9dd8ff 0%, #e9f7ff 70%, #f8d7a0 100%);
      border: 3px solid #2e4a7a;
      border-radius: 18px;
      overflow: hidden;
      user-select: none;
      touch-action: manipulation;
      box-shadow: 0 22px 48px rgba(18, 57, 104, 0.22);
    }
    #gazier-runner[data-state="over"] {
      filter: grayscale(0.35);
    }
    #gazier-runner .sky {
      position: absolute;
      inset: 0;
      z-index: 0;
    }
    #gazier-runner .cloud {
      position: absolute;
      top: 12%;
      width: 20%;
      height: 26px;
      background: rgba(255, 255, 255, 0.82);
      border-radius: 22px;
      box-shadow: 18px 6px 0 rgba(255, 255, 255, 0.74), 38px 10px 0 rgba(255, 255, 255, 0.68);
      pointer-events: none;
    }
    #gazier-runner .cloud:nth-child(2) {
      top: 26%;
      width: 16%;
      height: 22px;
      opacity: 0.92;
    }
    #gazier-runner .hud {
      position: absolute;
      top: 14px;
      left: 14px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: clamp(13px, 3.4vw, 16px);
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.6px;
    }
    #gazier-runner .hud-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      min-width: 156px;
      padding: 8px 14px;
      border-radius: 12px;
      background: rgba(255, 249, 230, 0.9);
      color: #2f1f0f;
      box-shadow: 0 10px 24px rgba(82, 52, 18, 0.16);
      border: 2px solid #f4c96a;
    }
    #gazier-runner .hud-item .value {
      font-family: "Courier New", monospace;
      font-variant-numeric: tabular-nums;
      color: #0d6a44;
    }
    #gazier-runner .message {
      position: absolute;
      inset: auto 10% 12%;
      padding: 14px 18px;
      background: rgba(255, 240, 210, 0.92);
      border: 3px solid #f2c162;
      border-radius: 14px;
      color: #3c260e;
      font-size: clamp(13px, 3.8vw, 17px);
      line-height: 1.45;
      text-align: center;
      z-index: 12;
      box-shadow: 0 18px 28px rgba(57, 38, 16, 0.18);
      transition: opacity 220ms ease;
    }
    #gazier-runner[data-hint="hidden"] .message {
      opacity: 0;
      pointer-events: none;
    }
    #gazier-runner .flash {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease-out;
      z-index: 9;
    }
    #gazier-runner[data-hit="true"] .flash {
      opacity: 1;
    }
    #gazier-runner .ground-wrapper {
      position: absolute;
      inset: auto 0 0;
      height: 38px;
      overflow: hidden;
      z-index: 2;
    }
    #gazier-runner .ground {
      position: absolute;
      bottom: 0;
      width: 220%;
      height: 38px;
      background:
        linear-gradient(#9f5a34 0 10%, #6f3218 10% 28%, #d8904c 28% 100%);
    }
    #gazier-runner .ground::before {
      content: "";
      position: absolute;
      inset: 10px 0 0;
      background:
        repeating-linear-gradient(90deg, rgba(59, 26, 8, 0.35) 0 48px, transparent 48px 52px),
        repeating-linear-gradient(#f2b46a 0 20px, #c2723b 20px 24px);
      opacity: 0.75;
    }
    #gazier-runner .line {
      position: absolute;
      top: -12px;
      left: 0;
      width: 200%;
      height: 12px;
      background:
        linear-gradient(#f7e1ac, #d0974a);
      box-shadow: inset 0 -4px 0 rgba(55, 23, 6, 0.28);
    }
    #gazier-runner .gazier {
      position: absolute;
      left: 16%;
      bottom: 38px;
      width: clamp(46px, 7vw, 64px);
      height: clamp(56px, 8.5vw, 78px);
      border-radius: 14px;
      background:
        radial-gradient(circle at 50% 26%, #f5b579 0 18%, transparent 19%),
        radial-gradient(circle at 36% 28%, #1e1e1e 0 5%, transparent 6%),
        radial-gradient(circle at 64% 28%, #1e1e1e 0 5%, transparent 6%),
        radial-gradient(circle at 50% 38%, #ef9d5e 0 6%, transparent 7%),
        linear-gradient(180deg, #fbe1be 0 38%, #d63c2e 38% 52%, #1764d7 52% 82%, #0e3a7a 82% 100%);
      box-shadow: 0 10px 0 rgba(0, 0, 0, 0.08);
      z-index: 4;
      transition: filter 120ms ease-in-out;
    }
    #gazier-runner .gazier::before {
      content: "G";
      position: absolute;
      top: -22%;
      left: 14%;
      width: 72%;
      height: 36%;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50% 50% 65% 65%;
      background: linear-gradient(#e43c2d, #b31615);
      border: 3px solid #741012;
      color: #fff;
      font-weight: 700;
      font-size: clamp(15px, 2.6vw, 18px);
      text-shadow: 0 1px 0 #4a0708;
      letter-spacing: 1px;
    }
    #gazier-runner .gazier::after {
      content: "";
      position: absolute;
      left: 28%;
      top: 44%;
      width: 44%;
      height: 18%;
      background: radial-gradient(circle, #3a1b08 0 58%, transparent 60%);
      border-radius: 50% / 60%;
      box-shadow: -8px 2px 0 #3a1b08, 8px 2px 0 #3a1b08;
      transform: scaleY(0.9);
    }
    #gazier-runner .obstacle {
      position: absolute;
      bottom: 38px;
      width: clamp(34px, 7vw, 50px);
      height: clamp(60px, 16vw, 110px);
      background:
        linear-gradient(180deg, #34b24a 0 14%, #2f9640 14% 84%, #1d6b2c 84% 100%);
      border-radius: 6px 6px 2px 2px;
      border: 3px solid #1d6b2c;
      box-shadow: inset 6px 0 0 rgba(255, 255, 255, 0.12);
      z-index: 3;
    }
    #gazier-runner .obstacle.little {
      height: clamp(50px, 12vw, 92px);
    }
    #gazier-runner .obstacle.tall {
      height: clamp(78px, 20vw, 140px);
      background:
        linear-gradient(180deg, #2e9e44 0 10%, #29a140 10% 80%, #1a6a2c 80% 100%);
    }
    @media (min-width: 720px) {
      #gazier-runner {
        width: 520px;
        height: 340px;
      }
      #gazier-runner .hud {
        flex-direction: row;
        gap: 12px;
      }
    }
    @media (prefers-reduced-motion: reduce) {
      #gazier-runner {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
      }
    }
  </style>
</head>
<body>
  <div id="gazier-runner" data-state="ready" data-hint="visible" data-hit="false">
    <div class="sky">
      <div class="cloud" style="left:16%;"></div>
      <div class="cloud" style="left:62%;"></div>
    </div>
    <div class="hud">
      <div class="hud-item">
        <span class="label">Niveau</span>
        <span class="value" data-level>01</span>
      </div>
      <div class="hud-item">
        <span class="label">Points</span>
        <span class="value" data-score>00000</span>
      </div>
      <div class="hud-item">
        <span class="label">Record</span>
        <span class="value" data-best-level>01</span>
      </div>
    </div>
    <div class="message" data-message>
      Touchez l'écran pour faire sauter Gazier !
    </div>
    <div class="flash"></div>
    <div class="ground-wrapper">
      <div class="line"></div>
      <div class="ground"></div>
    </div>
    <div class="gazier" data-gazier></div>
  </div>

  <script>
    (function initGazierRunner() {
      const container = document.getElementById('gazier-runner');
      if (!container || container.dataset.ready === 'true') {
        return;
      }
      container.dataset.ready = 'true';

      const gazierEl = container.querySelector('[data-gazier]');
      const groundEl = container.querySelector('.ground');
      const messageEl = container.querySelector('[data-message]');
      const scoreEl = container.querySelector('[data-score]');
      const levelEl = container.querySelector('[data-level]');
      const bestLevelEl = container.querySelector('[data-best-level]');
      const flashEl = container.querySelector('.flash');

      const GROUND_HEIGHT = 38;
      const BASE_SPEED = 280;
      const MAX_SPEED = 680;
      const SPEED_ACCEL = 70;
      const GRAVITY = 2200;
      const JUMP_VELOCITY = 760;
      const LEVEL_INTERVAL = 450;
      const OBSTACLE_GAP_MIN = 760;
      const OBSTACLE_GAP_MAX = 1240;

      let worldWidth = container.clientWidth;
      let lastTime = null;
      let speed = BASE_SPEED;
      let score = 0;
      let level = 1;
      let bestLevel = Number(localStorage.getItem('moreapp:gazier:best-level') || 1);
      let gazierY = 0;
      let velocityY = 0;
      let nextObstacleIn = randomGap();
      let obstacles = [];
      let gameState = 'ready';

      levelEl.textContent = formatLevel(level);
      bestLevelEl.textContent = formatLevel(bestLevel);
      scoreEl.textContent = formatScore(score);

      function randomGap() {
        return Math.random() * (OBSTACLE_GAP_MAX - OBSTACLE_GAP_MIN) + OBSTACLE_GAP_MIN;
      }

      function formatScore(value) {
        return String(Math.floor(value)).padStart(5, '0');
      }

      function formatLevel(value) {
        return String(Math.max(1, Math.floor(value))).padStart(2, '0');
      }

      function setMessage(text) {
        messageEl.textContent = text;
      }

      function hideHint() {
        container.dataset.hint = 'hidden';
      }

      function showHint() {
        container.dataset.hint = 'visible';
      }

      function resetGame() {
        obstacles.forEach((item) => item.el.remove());
        obstacles = [];
        speed = BASE_SPEED;
        score = 0;
        level = 1;
        nextObstacleIn = randomGap();
        gazierY = 0;
        velocityY = 0;
        updateGazier();
        updateScore(0);
        updateLevel(true);
        container.dataset.state = 'running';
        container.dataset.hit = 'false';
        hideHint();
        gameState = 'running';
        lastTime = null;
        window.requestAnimationFrame(step);
      }

      function updateScore(deltaSeconds) {
        score += deltaSeconds * 100;
        if (score < 0) score = 0;
        scoreEl.textContent = formatScore(score);
        updateLevel();
      }

      function updateLevel(force) {
        const computed = Math.floor(score / LEVEL_INTERVAL) + 1;
        if (force || computed !== level) {
          level = computed;
          levelEl.textContent = formatLevel(level);
          if (level > bestLevel) {
            bestLevel = level;
            bestLevelEl.textContent = formatLevel(bestLevel);
            localStorage.setItem('moreapp:gazier:best-level', bestLevel);
          }
        }
      }

      function updateGazier() {
        const bottom = GROUND_HEIGHT + gazierY;
        gazierEl.style.bottom = bottom + 'px';
      }

      function spawnObstacle() {
        const obstacleEl = document.createElement('div');
        obstacleEl.className = 'obstacle pipe';
        if (Math.random() > 0.6) {
          obstacleEl.classList.add('little');
        } else if (Math.random() > 0.6) {
          obstacleEl.classList.add('tall');
        }
        container.appendChild(obstacleEl);
        const rect = obstacleEl.getBoundingClientRect();
        const obstacle = {
          el: obstacleEl,
          width: rect.width || 40,
          height: rect.height || 80,
          x: worldWidth
        };
        obstacleEl.style.transform = 'translateX(' + Math.round(obstacle.x) + 'px)';
        obstacles.push(obstacle);
      }

      function updateObstacles(deltaSeconds) {
        const distance = speed * deltaSeconds;
        obstacles = obstacles.filter((obstacle) => {
          obstacle.x -= distance;
          if (obstacle.x + obstacle.width < 0) {
            obstacle.el.remove();
            return false;
          }
          obstacle.el.style.transform = 'translateX(' + Math.round(obstacle.x) + 'px)';
          return true;
        });
        nextObstacleIn -= distance;
        if (nextObstacleIn <= 0) {
          spawnObstacle();
          nextObstacleIn = randomGap();
        }
      }

      function updateGround(deltaSeconds) {
        const shift = (groundEl._shift || 0) - speed * deltaSeconds;
        const loopPoint = worldWidth;
        groundEl._shift = shift <= -loopPoint ? shift + loopPoint : shift;
        groundEl.style.transform = 'translateX(' + Math.round(groundEl._shift) + 'px)';
      }

      function updatePhysics(deltaSeconds) {
        velocityY -= GRAVITY * deltaSeconds;
        gazierY += velocityY * deltaSeconds;
        if (gazierY <= 0) {
          gazierY = 0;
          velocityY = 0;
        }
        updateGazier();
      }

      function checkCollisions() {
        const gazierRect = gazierEl.getBoundingClientRect();
        return obstacles.some((obstacle) => {
          const rect = obstacle.el.getBoundingClientRect();
          return (
            rect.left < gazierRect.right - 4 &&
            rect.right > gazierRect.left + 4 &&
            rect.top < gazierRect.bottom - 6 &&
            rect.bottom > gazierRect.top + 6
          );
        });
      }

      function step(timestamp) {
        if (gameState !== 'running') {
          return;
        }
        if (lastTime === null) {
          lastTime = timestamp;
          window.requestAnimationFrame(step);
          return;
        }
        const deltaSeconds = (timestamp - lastTime) / 1000;
        lastTime = timestamp;

        updatePhysics(deltaSeconds);
        updateObstacles(deltaSeconds);
        updateGround(deltaSeconds);
        updateScore(deltaSeconds);
        speed = Math.min(speed + SPEED_ACCEL * deltaSeconds, MAX_SPEED);

        if (checkCollisions()) {
          onGameOver();
          return;
        }

        window.requestAnimationFrame(step);
      }

      function onGameOver() {
        gameState = 'over';
        container.dataset.state = 'over';
        container.dataset.hit = 'true';
        showHint();
        setMessage('Perdu ! Gazier repart en mission ? Touchez pour rejouer.');
        flashEl.getBoundingClientRect();
        flashEl.style.opacity = '1';
        window.setTimeout(() => {
          flashEl.style.opacity = '0';
        }, 90);
      }

      function jump() {
        if (gameState === 'ready') {
          setMessage('Évite les tuyaux et grimpe les niveaux avec Gazier !');
          resetGame();
          return;
        }
        if (gameState !== 'running') {
          if (gameState === 'over') {
            resetGame();
          }
          return;
        }
        if (gazierY === 0) {
          velocityY = JUMP_VELOCITY;
          container.dataset.hit = 'false';
        }
      }

      function handleKey(event) {
        const keys = [' ', 'Spacebar', 'ArrowUp'];
        if (keys.includes(event.key)) {
          event.preventDefault();
          jump();
        }
      }

      function handlePointer(event) {
        event.preventDefault();
        jump();
      }

      function handleResize() {
        worldWidth = container.clientWidth;
      }

      window.addEventListener('keydown', handleKey);
      container.addEventListener('pointerdown', handlePointer, { passive: false });
      window.addEventListener('resize', handleResize);

      window.requestAnimationFrame(step);
    })();
  </script>
</body>
</html>
