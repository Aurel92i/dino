<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Mini Gazier Runner</title>
  <style>
    :root {
      color-scheme: light;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: clamp(18px, 6vw, 48px);
      background: linear-gradient(180deg, #6cb4ff 0%, #8fd1ff 60%, #fdf4cc 100%);
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100dvh;
    }
    #gazier-runner {
      position: relative;
      width: min(520px, 96vw);
      height: clamp(260px, 60vh, 360px);
      background: linear-gradient(#96d7ff 0%, #e4f5ff 70%, #f5d79a 100%);
      border: 3px solid #25366b;
      border-radius: 20px;
      overflow: hidden;
      user-select: none;
      touch-action: manipulation;
      box-shadow: 0 24px 54px rgba(23, 58, 110, 0.24);
    }
    #gazier-runner[data-state="over"] {
      filter: grayscale(0.45);
    }
    #gazier-runner .sky {
      position: absolute;
      inset: 0;
      z-index: 0;
    }
    #gazier-runner .cloud {
      position: absolute;
      top: 12%;
      width: 22%;
      height: 28px;
      background: rgba(255, 255, 255, 0.88);
      border-radius: 20px;
      box-shadow: 20px 6px 0 rgba(255, 255, 255, 0.78), 44px 10px 0 rgba(255, 255, 255, 0.7);
      pointer-events: none;
    }
    #gazier-runner .cloud:nth-child(2) {
      top: 28%;
      width: 16%;
      height: 22px;
      opacity: 0.92;
    }
    #gazier-runner .hill {
      position: absolute;
      bottom: 38px;
      width: 32%;
      height: 28%;
      background: radial-gradient(circle at 50% 120%, #2b7a3d 0 52%, rgba(43, 122, 61, 0) 55%);
      z-index: 1;
    }
    #gazier-runner .hill:nth-of-type(3) {
      left: 6%;
    }
    #gazier-runner .hill:nth-of-type(4) {
      right: 12%;
      width: 26%;
    }
    #gazier-runner .hud {
      position: absolute;
      top: 14px;
      left: 14px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: clamp(13px, 3.6vw, 16px);
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.6px;
    }
    #gazier-runner .hud-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      min-width: 170px;
      padding: 8px 16px;
      border-radius: 14px;
      background: rgba(255, 246, 214, 0.92);
      color: #2c1b0c;
      border: 2px solid #f4c96a;
      box-shadow: 0 12px 26px rgba(71, 45, 16, 0.18);
    }
    #gazier-runner .hud-item .value {
      font-family: "Courier New", monospace;
      font-variant-numeric: tabular-nums;
      color: #0b6b3d;
    }
    #gazier-runner .message {
      position: absolute;
      inset: auto 12% 14%;
      padding: 16px 20px;
      background: rgba(255, 238, 204, 0.94);
      border: 3px solid #f1c05b;
      border-radius: 16px;
      color: #3b250c;
      font-size: clamp(14px, 3.8vw, 18px);
      line-height: 1.5;
      text-align: center;
      z-index: 12;
      box-shadow: 0 18px 32px rgba(52, 32, 12, 0.18);
      transition: opacity 220ms ease;
    }
    #gazier-runner[data-hint="hidden"] .message {
      opacity: 0;
      pointer-events: none;
    }
    #gazier-runner .flash {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease-out;
      z-index: 9;
    }
    #gazier-runner[data-hit="true"] .flash {
      opacity: 1;
    }
    #gazier-runner .ground-wrapper {
      position: absolute;
      inset: auto 0 0;
      height: 46px;
      overflow: hidden;
      z-index: 2;
    }
    #gazier-runner .ground {
      position: absolute;
      bottom: 0;
      width: 220%;
      height: 46px;
      background:
        linear-gradient(#f7b347 0 12%, #b96528 12% 40%, #f18632 40% 60%, #7a3a1c 60% 100%);
    }
    #gazier-runner .ground::before {
      content: "";
      position: absolute;
      inset: 14px 0 0;
      background:
        repeating-linear-gradient(90deg, rgba(54, 26, 7, 0.34) 0 52px, transparent 52px 58px),
        repeating-linear-gradient(#fcd872 0 24px, #e48c36 24px 30px);
      opacity: 0.85;
    }
    #gazier-runner .line {
      position: absolute;
      top: -12px;
      left: 0;
      width: 200%;
      height: 14px;
      background: linear-gradient(#f8e0af, #d18736);
      box-shadow: inset 0 -4px 0 rgba(63, 32, 10, 0.26);
    }
    #gazier-runner .gazier {
      position: absolute;
      left: 18%;
      bottom: 46px;
      width: clamp(50px, 8vw, 72px);
      height: clamp(66px, 10vw, 92px);
      z-index: 4;
      transform-origin: center bottom;
    }
    .gazier__body,
    .gazier__head,
    .gazier__arm,
    .gazier__leg {
      position: absolute;
    }
    .gazier__body {
      bottom: 16px;
      left: 12px;
      width: calc(100% - 24px);
      height: calc(100% - 28px);
      border-radius: 12px;
      background: linear-gradient(180deg, #1b75d1 0 70%, #0f4fa8 70% 100%);
      border: 3px solid #0f275a;
      box-shadow: inset -4px 0 0 rgba(0, 0, 0, 0.12);
    }
    .gazier__head {
      top: 0;
      left: 18px;
      width: calc(100% - 36px);
      height: 44%;
      border-radius: 14px 14px 12px 12px;
      background: linear-gradient(180deg, #f9d19c, #f0b16f);
      border: 3px solid #47210a;
    }
    .gazier__head::before {
      content: "";
      position: absolute;
      left: 20%;
      top: 34%;
      width: 60%;
      height: 16%;
      background: radial-gradient(circle, #1f1f1f 0 55%, transparent 58%);
      border-radius: 50% / 60%;
      box-shadow: -10px 4px 0 #1f1f1f, 10px 4px 0 #1f1f1f;
    }
    .gazier__head::after {
      content: "";
      position: absolute;
      left: 18%;
      bottom: 24%;
      width: 64%;
      height: 18%;
      border-radius: 0 0 60% 60%;
      background: #c4512a;
    }
    .gazier__cap {
      position: absolute;
      top: -18px;
      left: 6px;
      width: calc(100% - 12px);
      height: 40px;
      background: linear-gradient(#e83e2f, #aa1616);
      border-radius: 20px 20px 60% 60%;
      border: 3px solid #6b0509;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      letter-spacing: 1px;
      font-size: clamp(10px, 2.6vw, 14px);
      text-shadow: 0 1px 0 #4c0406;
    }
    .gazier__arm {
      top: 44%;
      width: 16px;
      height: 30px;
      border-radius: 8px;
      background: linear-gradient(#f8c99a, #d57c3f);
      border: 3px solid #47210a;
      transform-origin: top center;
    }
    .gazier__arm--front {
      left: 4px;
    }
    .gazier__arm--back {
      right: 4px;
    }
    .gazier__leg {
      bottom: 0;
      width: 18px;
      height: 32px;
      background: linear-gradient(#1657cf, #0f3a94);
      border: 3px solid #0f275a;
      border-radius: 6px;
      transform-origin: top center;
    }
    .gazier__leg::after {
      content: "";
      position: absolute;
      left: -6px;
      bottom: -10px;
      width: 30px;
      height: 12px;
      border-radius: 8px;
      background: #0f275a;
    }
    .gazier__leg--front {
      left: 12px;
    }
    .gazier__leg--back {
      right: 12px;
    }
    .gazier.is-running .gazier__leg--front {
      animation: leg-run 260ms linear infinite;
    }
    .gazier.is-running .gazier__leg--back {
      animation: leg-run 260ms linear infinite reverse;
    }
    .gazier.is-running .gazier__arm--front {
      animation: arm-run 320ms linear infinite;
    }
    .gazier.is-running .gazier__arm--back {
      animation: arm-run 320ms linear infinite reverse;
    }
    .gazier.is-jumping {
      animation: jump-tilt 380ms ease-out forwards;
    }
    @keyframes leg-run {
      0% { transform: rotate(18deg); }
      50% { transform: rotate(-22deg); }
      100% { transform: rotate(18deg); }
    }
    @keyframes arm-run {
      0% { transform: rotate(-24deg); }
      50% { transform: rotate(18deg); }
      100% { transform: rotate(-24deg); }
    }
    @keyframes jump-tilt {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-4px) rotate(-4deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }
    #gazier-runner .obstacle {
      position: absolute;
      bottom: 46px;
      width: clamp(38px, 8vw, 52px);
      height: clamp(56px, 18vw, 110px);
      background: linear-gradient(180deg, #39b24a 0 12%, #2f9c40 12% 88%, #1e6c2c 88% 100%);
      border-radius: 6px 6px 4px 4px;
      border: 3px solid #1f6f2d;
      box-shadow: inset 6px 0 0 rgba(255, 255, 255, 0.12);
      z-index: 3;
    }
    #gazier-runner .obstacle.little {
      height: clamp(48px, 16vw, 92px);
    }
    #gazier-runner .obstacle.tall {
      height: clamp(72px, 22vw, 130px);
    }
    @media (min-width: 720px) {
      #gazier-runner {
        width: 560px;
        height: 360px;
      }
      #gazier-runner .hud {
        flex-direction: row;
        gap: 12px;
      }
      #gazier-runner .hud-item {
        min-width: 150px;
      }
    }
    @media (prefers-reduced-motion: reduce) {
      #gazier-runner,
      .gazier {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
      }
    }
  </style>
</head>
<body>
  <div id="gazier-runner" data-state="ready" data-hint="visible" data-hit="false">
    <div class="sky">
      <div class="cloud" style="left:14%;"></div>
      <div class="cloud" style="left:64%;"></div>
      <div class="hill"></div>
      <div class="hill"></div>
    </div>
    <div class="hud">
      <div class="hud-item">
        <span class="label">Niveau</span>
        <span class="value" data-level>01</span>
      </div>
      <div class="hud-item">
        <span class="label">NR</span>
        <span class="value" data-score>00000</span>
      </div>
      <div class="hud-item">
        <span class="label">Record</span>
        <span class="value" data-best-level>01</span>
      </div>
    </div>
    <div class="message" data-message>
      Touchez l'écran pour faire courir Gazier !
    </div>
    <div class="flash"></div>
    <div class="ground-wrapper">
      <div class="line"></div>
      <div class="ground"></div>
    </div>
    <div class="gazier" data-gazier>
      <div class="gazier__body"></div>
      <div class="gazier__head"></div>
      <div class="gazier__cap">Gazier</div>
      <div class="gazier__arm gazier__arm--front"></div>
      <div class="gazier__arm gazier__arm--back"></div>
      <div class="gazier__leg gazier__leg--front"></div>
      <div class="gazier__leg gazier__leg--back"></div>
    </div>
  </div>

  <script>
    (function initGazierRunner() {
      const container = document.getElementById('gazier-runner');
      if (!container || container.dataset.ready === 'true') {
        return;
      }
      container.dataset.ready = 'true';

      const gazierEl = container.querySelector('[data-gazier]');
      const groundEl = container.querySelector('.ground');
      const messageEl = container.querySelector('[data-message]');
      const scoreEl = container.querySelector('[data-score]');
      const levelEl = container.querySelector('[data-level]');
      const bestLevelEl = container.querySelector('[data-best-level]');
      const flashEl = container.querySelector('.flash');

      const GROUND_HEIGHT = 46;
      const BASE_SPEED = 320;
      const MAX_SPEED = 760;
      const SPEED_ACCEL = 80;
      const GRAVITY = 2250;
      const JUMP_VELOCITY = 800;
      const LEVEL_INTERVAL = 480;
      const OBSTACLE_GAP_MIN = 820;
      const OBSTACLE_GAP_MAX = 1360;

      let worldWidth = container.clientWidth;
      let lastTime = null;
      let speed = BASE_SPEED;
      let score = 0;
      let level = 1;
      let bestLevel = Number(localStorage.getItem('moreapp:gazier:best-level') || 1);
      let gazierY = 0;
      let velocityY = 0;
      let nextObstacleIn = randomGap();
      let obstacles = [];
      let gameState = 'ready';

      levelEl.textContent = formatLevel(level);
      bestLevelEl.textContent = formatLevel(bestLevel);
      scoreEl.textContent = formatScore(score);
      gazierEl.classList.add('is-running');

      function randomGap() {
        return Math.random() * (OBSTACLE_GAP_MAX - OBSTACLE_GAP_MIN) + OBSTACLE_GAP_MIN;
      }

      function formatScore(value) {
        return String(Math.floor(value)).padStart(5, '0');
      }

      function formatLevel(value) {
        return String(Math.max(1, Math.floor(value))).padStart(2, '0');
      }

      function setMessage(text) {
        messageEl.textContent = text;
      }

      function hideHint() {
        container.dataset.hint = 'hidden';
      }

      function showHint() {
        container.dataset.hint = 'visible';
      }

      function resetGame() {
        obstacles.forEach((item) => item.el.remove());
        obstacles = [];
        speed = BASE_SPEED;
        score = 0;
        level = 1;
        nextObstacleIn = randomGap();
        gazierY = 0;
        velocityY = 0;
        updateGazier();
        updateScore(0);
        updateLevel(true);
        container.dataset.state = 'running';
        container.dataset.hit = 'false';
        hideHint();
        gameState = 'running';
        lastTime = null;
        window.requestAnimationFrame(step);
      }

      function updateScore(deltaSeconds) {
        score += deltaSeconds * 120;
        if (score < 0) score = 0;
        scoreEl.textContent = formatScore(score);
        updateLevel();
      }

      function updateLevel(force) {
        const computed = Math.floor(score / LEVEL_INTERVAL) + 1;
        if (force || computed !== level) {
          level = computed;
          levelEl.textContent = formatLevel(level);
          if (level > bestLevel) {
            bestLevel = level;
            bestLevelEl.textContent = formatLevel(bestLevel);
            localStorage.setItem('moreapp:gazier:best-level', bestLevel);
          }
        }
      }

      function updateGazier() {
        const bottom = GROUND_HEIGHT + gazierY;
        gazierEl.style.bottom = bottom + 'px';
        if (gazierY === 0) {
          gazierEl.classList.add('is-running');
          gazierEl.classList.remove('is-jumping');
        } else {
          gazierEl.classList.add('is-jumping');
          gazierEl.classList.remove('is-running');
        }
      }

      function spawnObstacle() {
        const obstacleEl = document.createElement('div');
        obstacleEl.className = 'obstacle';
        if (Math.random() > 0.65) {
          obstacleEl.classList.add('little');
        } else if (Math.random() > 0.7) {
          obstacleEl.classList.add('tall');
        }
        container.appendChild(obstacleEl);
        const rect = obstacleEl.getBoundingClientRect();
        const obstacle = {
          el: obstacleEl,
          width: rect.width || 42,
          height: rect.height || 90,
          x: worldWidth
        };
        obstacleEl.style.transform = 'translateX(' + Math.round(obstacle.x) + 'px)';
        obstacles.push(obstacle);
      }

      function updateObstacles(deltaSeconds) {
        const distance = speed * deltaSeconds;
        obstacles = obstacles.filter((obstacle) => {
          obstacle.x -= distance;
          if (obstacle.x + obstacle.width < 0) {
            obstacle.el.remove();
            return false;
          }
          obstacle.el.style.transform = 'translateX(' + Math.round(obstacle.x) + 'px)';
          return true;
        });
        nextObstacleIn -= distance;
        if (nextObstacleIn <= 0) {
          spawnObstacle();
          nextObstacleIn = randomGap();
        }
      }

      function updateGround(deltaSeconds) {
        const shift = (groundEl._shift || 0) - speed * deltaSeconds;
        const loopPoint = worldWidth;
        groundEl._shift = shift <= -loopPoint ? shift + loopPoint : shift;
        groundEl.style.transform = 'translateX(' + Math.round(groundEl._shift) + 'px)';
      }

      function updatePhysics(deltaSeconds) {
        velocityY -= GRAVITY * deltaSeconds;
        gazierY += velocityY * deltaSeconds;
        if (gazierY <= 0) {
          gazierY = 0;
          velocityY = 0;
        }
        updateGazier();
      }

      function checkCollisions() {
        const gazierRect = gazierEl.getBoundingClientRect();
        return obstacles.some((obstacle) => {
          const rect = obstacle.el.getBoundingClientRect();
          return (
            rect.left < gazierRect.right - 6 &&
            rect.right > gazierRect.left + 6 &&
            rect.top < gazierRect.bottom - 10 &&
            rect.bottom > gazierRect.top + 8
          );
        });
      }

      function step(timestamp) {
        if (gameState !== 'running') {
          return;
        }
        if (lastTime === null) {
          lastTime = timestamp;
          window.requestAnimationFrame(step);
          return;
        }
        const deltaSeconds = (timestamp - lastTime) / 1000;
        lastTime = timestamp;

        updatePhysics(deltaSeconds);
        updateObstacles(deltaSeconds);
        updateGround(deltaSeconds);
        updateScore(deltaSeconds);
        speed = Math.min(speed + SPEED_ACCEL * deltaSeconds, MAX_SPEED);

        if (checkCollisions()) {
          onGameOver();
          return;
        }

        window.requestAnimationFrame(step);
      }

      function onGameOver() {
        gameState = 'over';
        container.dataset.state = 'over';
        container.dataset.hit = 'true';
        showHint();
        setMessage('Oups ! Gazier repart en mission ? Touchez pour rejouer.');
        flashEl.getBoundingClientRect();
        flashEl.style.opacity = '1';
        window.setTimeout(() => {
          flashEl.style.opacity = '0';
        }, 120);
      }

      function jump() {
        if (gameState === 'ready') {
          setMessage('Évite les tuyaux et grimpe les niveaux avec Gazier !');
          resetGame();
          return;
        }
        if (gameState !== 'running') {
          if (gameState === 'over') {
            resetGame();
          }
          return;
        }
        if (gazierY === 0) {
          velocityY = JUMP_VELOCITY;
          container.dataset.hit = 'false';
        }
      }

      function handleKey(event) {
        const keys = [' ', 'Spacebar', 'ArrowUp'];
        if (keys.includes(event.key)) {
          event.preventDefault();
          jump();
        }
      }

      function handlePointer(event) {
        event.preventDefault();
        jump();
      }

      function handleResize() {
        worldWidth = container.clientWidth;
      }

      window.addEventListener('keydown', handleKey);
      container.addEventListener('pointerdown', handlePointer, { passive: false });
      window.addEventListener('resize', handleResize);

      window.requestAnimationFrame(step);
    })();
  </script>
</body>
</html>
